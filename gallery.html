<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WeAreTheSpace Gallery</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #f0f0f0;
  font-family: sans-serif;
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transform-origin: top center;
  width: 100%;
  height: 100%;
}

a.back-arrow {
  font-size: 40px;
  text-decoration: none;
  color: #333;
  margin-bottom: 10px;
}

#galleryArea {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.gallery-grid {
  display: grid;
  gap: 0;
}

.submission-tile {
  display: grid;
  gap: 0;
  aspect-ratio: 1 / 1; /* square submissions */
}

.submission-tile div {
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>
<main class="container">
  <a href="https://someotherworld369-debug.github.io/wearethespace/" class="back-arrow">‚Üê</a>
  <div id="galleryArea"></div>
</main>

<script>
const API_BASE = 'https://wearethespace-backend.onrender.com';
const apiUrl = API_BASE ? (API_BASE.replace(/\/$/, '') + '/api/submissions') : '/api/submissions';

const galleryArea = document.getElementById('galleryArea');

async function fetchFromApi() {
  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error('API GET failed');
    const subs = await res.json();
    return subs.map(s => ({
      id: s.id,
      size: s.size,
      cells: s.cells
    }));
  } catch (err) {
    const fallback = JSON.parse(localStorage.getItem('artGridSubmissions') || '[]');
    return fallback;
  }
}

function makeDesignTile(sub) {
  const outer = document.createElement('div');
  outer.className = 'submission-tile';
  outer.style.gridTemplateColumns = `repeat(${sub.size}, 1fr)`;
  outer.style.gridTemplateRows = `repeat(${sub.size}, 1fr)`;

  sub.cells.forEach(color => {
    const c = document.createElement('div');
    c.style.background = color || '#ffffff';
    outer.appendChild(c);
  });

  return outer;
}

function renderSubs(subs) {
  galleryArea.innerHTML = '';

  if (!subs.length) {
    galleryArea.innerHTML = '<p class="small-note">No submissions yet.</p>';
    return;
  }

  const totalSubs = subs.length;
  const dim = Math.ceil(Math.sqrt(totalSubs)); // square grid of submissions

  const container = document.createElement('div');
  container.className = 'gallery-grid';
  container.style.gridTemplateColumns = `repeat(${dim}, 1fr)`;
  container.style.gridTemplateRows = `repeat(${dim}, 1fr)`;
  container.style.width = '100%';
  container.style.height = '100%';

  subs.forEach(sub => {
    const tile = makeDesignTile(sub);
    container.appendChild(tile);
  });

  galleryArea.appendChild(container);

  // Calculate maximum size for each submission tile
  const containerWidth = galleryArea.clientWidth;
  const containerHeight = galleryArea.clientHeight;
  const tileSize = Math.min(containerWidth, containerHeight) / dim;

  container.childNodes.forEach(tile => {
    tile.style.width = `${tileSize}px`;
    tile.style.height = `${tileSize}px`;
  });
}

async function loadAndRender() {
  const subs = await fetchFromApi();
  renderSubs(subs);

  // Poll for new submissions
  setTimeout(loadAndRender, 2000);
}

window.addEventListener('resize', loadAndRender);
loadAndRender();
</script>
</body>
</html>
